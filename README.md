# MEXC Copy Trading Bot

Асинхронный бот для копи-трейдинга на фьючерсах MEXC с управлением через Telegram. Копирует все действия трейдера (сделки, лимитные ордера, тейк-профит/стоп-лосс) на множественные аккаунты в реальном времени.

## Архитектура

```
mexc_copytrading_bot/
├── main.py                 # Точка входа
├── config.py               # Конфигурация
├── requirements.txt        # Зависимости
├── .env.example            # Пример переменных окружения
├── bot/                    # Telegram интерфейс
│   ├── bot.py             # Инициализация бота
│   ├── handlers.py        # Обработчики команд
│   └── keyboards.py       # Клавиатуры
├── core/                   # Основная логика
│   ├── copytrading.py    # Менеджер копи-трейдинга
│   └── order_replicator.py # Репликатор ордеров
├── exchange/               # MEXC API
│   ├── mexc_client.py    # Клиент для фьючерсов MEXC
│   ├── auth.py           # Авторизация и подпись
│   └── order_monitor.py  # Мониторинг ордеров трейдера
├── database/              # База данных
│   ├── models.py         # Модели данных
│   └── repository.py     # Репозиторий
└── utils/                 # Утилиты
    └── logger.py         # Логирование
```

## Обоснование архитектуры

**Асинхронная архитектура (asyncio):**
- Поддержка 30+ аккаунтов без блокировок
- Эффективное использование ресурсов
- Быстрое копирование ордеров (критично для копи-трейдинга)

**Разделение на модули:**
- `exchange/` - изоляция работы с MEXC API, легко заменить при изменении API
- `core/` - чистая бизнес-логика копирования, независима от внешних сервисов
- `bot/` - интерфейс управления, можно заменить на веб/CLI
- `database/` - хранение конфигурации аккаунтов и истории

**Ключевые компоненты:**
- `order_monitor.py` - отслеживает все действия трейдера (ордера, изменения, отмены)
- `order_replicator.py` - реплицирует действия на все подключенные аккаунты
- `copytrading.py` - координатор всего процесса копирования

## Установка

```bash
pip install -r requirements.txt
cp .env.example .env
# Заполните .env своими данными
python main.py
```

## Конфигурация

В `.env` укажите:
- `MASTER_API_KEY` / `MASTER_API_SECRET` - аккаунт трейдера
- `SLAVE_ACCOUNTS` - JSON с API ключами подчиненных аккаунтов
- `TELEGRAM_BOT_TOKEN` - токен Telegram бота

## Руководство для разработчиков

Этот проект является стартовой точкой (шаблоном) для разработки бота копи-трейдинга. Ниже описано, с чего начать изучение кода и как организована архитектура.

### С чего начать изучение

Изучайте код в следующем порядке для понимания потока данных:

1. **`main.py`** - Точка входа
   - Показывает, как инициализируются все компоненты
   - Демонстрирует graceful shutdown
   - Показывает порядок запуска: логирование → БД → бот → менеджер копи-трейдинга

2. **`config.py`** - Конфигурация
   - Все настройки приложения в одном месте
   - Использование pydantic для валидации
   - Парсинг переменных окружения

3. **`core/copytrading.py`** - Менеджер копи-трейдинга
   - Главный координатор всего процесса
   - Связывает мониторинг master аккаунта с репликацией на slave
   - Callbacks для обработки событий (новый ордер, изменение, отмена)

4. **`exchange/order_monitor.py`** - Мониторинг ордеров
   - Как отслеживаются действия трейдера
   - Периодический опрос открытых ордеров
   - Обнаружение изменений через сравнение состояний

5. **`core/order_replicator.py`** - Репликатор ордеров
   - Как ордера копируются на все аккаунты
   - Параллельное выполнение через asyncio.gather
   - Применение множителя и обработка ошибок

6. **`exchange/mexc_client.py`** - Клиент MEXC API
   - Абстракция работы с биржей
   - Все методы API в одном месте
   - Асинхронные запросы через aiohttp

7. **`bot/`** - Telegram интерфейс
   - Обработчики команд (`handlers.py`)
   - Клавиатуры (`keyboards.py`)
   - Инициализация бота (`bot.py`)

### Структура проекта и назначение модулей

```
mexc_copytrading_bot/
├── main.py                    # Точка входа - запуск всех компонентов
├── config.py                  # Конфигурация - настройки из .env
│
├── core/                      # Бизнес-логика копи-трейдинга
│   ├── copytrading.py        # Менеджер - координатор всего процесса
│   ├── order_replicator.py   # Репликация ордеров на slave аккаунты
│   └── strategy.py           # Стратегии копирования (расширяемо)
│
├── exchange/                  # Работа с биржей MEXC
│   ├── mexc_client.py        # Клиент API - все методы работы с биржей
│   ├── auth.py              # Авторизация и подпись запросов
│   └── order_monitor.py     # Мониторинг ордеров master аккаунта
│
├── bot/                       # Telegram интерфейс
│   ├── bot.py               # Инициализация aiogram бота
│   ├── handlers.py          # Обработчики команд (/start, /status и т.д.)
│   ├── keyboards.py         # Inline клавиатуры для управления
│   └── middleware.py        # Middleware для логирования/валидации
│
├── database/                  # База данных
│   ├── models.py            # SQLAlchemy модели (аккаунты, история)
│   └── repository.py        # CRUD операции с БД
│
└── utils/                     # Утилиты
    └── logger.py            # Настройка логирования
```

### Обоснование архитектурного подхода

**1. Разделение на слои (Layered Architecture)**

- **`exchange/`** - слой работы с внешним API
  - Изоляция логики биржи от бизнес-логики
  - Легко заменить на другую биржу или API
  - Все HTTP-запросы и авторизация в одном месте

- **`core/`** - бизнес-логика
  - Независима от конкретной биржи или интерфейса
  - Можно тестировать без реальных API-вызовов
  - Легко расширять новыми стратегиями копирования

- **`bot/`** - интерфейс пользователя
  - Можно заменить на веб-интерфейс или CLI
  - Бизнес-логика не зависит от способа управления

**2. Асинхронная архитектура (asyncio)**

- **Почему критично**: копи-трейдинг требует минимальной задержки
- **Параллельная репликация**: все аккаунты обрабатываются одновременно через `asyncio.gather`
- **Неблокирующий I/O**: опрос ордеров не блокирует репликацию
- **Масштабируемость**: поддержка 30+ аккаунтов без деградации производительности

**3. Паттерн Observer для мониторинга**

- `OrderMonitor` наблюдает за master аккаунтом
- При обнаружении изменений вызывает callbacks в `CopyTradingManager`
- Слабая связанность: монитор не знает о репликаторе напрямую

**4. Dependency Injection**

- Компоненты получают зависимости через конструктор
- Легко тестировать (можно подставить mock-объекты)
- Пример: `OrderMonitor` получает `MEXCClient` в конструкторе

**5. Централизованная конфигурация**

- Все настройки в `config.py` через pydantic
- Валидация при старте приложения
- Переменные окружения для секретов (API ключи)

### Что нужно доработать (TODO в коде)

Проект содержит шаблоны с заглушками. Основные места для реализации:

1. **`exchange/mexc_client.py`** - все методы помечены `# TODO`
   - `place_order()` - размещение ордера
   - `cancel_order()` - отмена ордера
   - `get_open_orders()` - получение открытых ордеров
   - Изучите [MEXC Futures API документацию](https://mexcdevelop.github.io/apidocs/contract_v1_en/)

2. **`exchange/auth.py`** - авторизация и подпись запросов
   - Реализовать подпись запросов по стандарту MEXC

3. **`core/order_replicator.py`** - методы репликации
   - `replicate_cancel()` - отмена ордеров
   - `replicate_modify()` - изменение ордеров

4. **`database/models.py`** - модели данных
   - Модели для хранения истории ордеров, настроек аккаунтов

5. **`bot/handlers.py`** - обработчики команд
   - Расширить функционал управления через Telegram

### Рекомендации по разработке

1. **Начните с `exchange/mexc_client.py`** - без работы с API остальное не имеет смысла
2. **Используйте тестовый аккаунт** - не тестируйте на реальных деньгах
3. **Логируйте все операции** - критично для отладки копи-трейдинга
4. **Обрабатывайте ошибки** - ошибка на одном аккаунте не должна ломать остальные
5. **Тестируйте параллельность** - убедитесь, что репликация действительно параллельная

## Лицензия

MIT
